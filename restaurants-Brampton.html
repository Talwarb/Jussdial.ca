<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restaurants in Brampton - JussDial</title>
<meta name="description" content="Browse restaurants and eateries in Brampton with JussDial.">
<meta name="robots" content="index, follow">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body { font-family: Arial, sans-serif; margin:0; }
  .container { display: flex; flex-wrap: wrap; }
  .sidebar { width: 30%; max-height: 90vh; overflow-y: auto; padding:10px; border-right:1px solid #ccc; }
  .card { padding:10px; border:1px solid #ddd; margin-bottom:10px; cursor:pointer; border-radius:5px; }
  .card:hover { background:#f0f0f0; }
  .map-container { width: 70%; height:90vh; }
  #map { height:100%; }
  #searchInput { width:100%; padding:5px; margin-bottom:10px; font-size:16px; }
  a { text-decoration:none; color:blue; }
</style>
</head>
<body>

<header style="padding:10px; text-align:center;">
  <h1>Restaurants in Brampton</h1>
  <p>Click a marker or card to see details. Use search to filter.</p>
</header>

<div class="container">
  <div class="sidebar">
    <input id="searchInput" type="text" placeholder="Search restaurants...">
    <div id="cardList"></div>
  </div>
  <div class="map-container">
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  var map = L.map('map').setView([43.7315, -79.7624], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  var markers = [];
  var cardList = document.getElementById('cardList');
  var userLat = null, userLon = null;

  // Try to get user location
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(function(position){
      userLat = position.coords.latitude;
      userLon = position.coords.longitude;
    });
  }

  // Overpass API query for restaurants in Brampton
  var overpassQuery = `
    [out:json][timeout:25];
    area["name"="Brampton"]->.searchArea;
    (
      node["amenity"="restaurant"](area.searchArea);
      way["amenity"="restaurant"](area.searchArea);
      relation["amenity"="restaurant"](area.searchArea);
    );
    out center;
  `;

  fetch('https://overpass-api.de/api/interpreter?data=' + encodeURIComponent(overpassQuery))
    .then(r => r.json())
    .then(data => {
      data.elements.forEach(el => {
        var lat = el.lat || el.center?.lat;
        var lon = el.lon || el.center?.lon;
        if(!lat || !lon) return;

        var tags = el.tags || {};
        var name = tags.name || "Unnamed Restaurant";
        var address = '';
        if(tags['addr:housenumber'] || tags['addr:street'] || tags['addr:city']) {
          address = `ğŸ“ ${tags['addr:housenumber']||''} ${tags['addr:street']||''}, ${tags['addr:city']||''}`.trim();
        }
        var phone = tags.phone ? `ğŸ“ ${tags.phone}` : '';
        var website = tags.website ? `ğŸŒ <a href="${tags.website}" target="_blank">${tags.website}</a>` : '';

        // Directions link using user location if available
        var directionsLink = userLat && userLon ? 
          `<br><a href="https://www.google.com/maps/dir/?api=1&origin=${userLat},${userLon}&destination=${lat},${lon}" target="_blank">Get Directions</a>` :
          `<br><a href="https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}" target="_blank">Get Directions</a>`;

        // Add marker
        var marker = L.marker([lat, lon]).addTo(map)
          .bindPopup(`<strong>${name}</strong><br>${address}<br>${phone}<br>${website}${directionsLink}`);
        marker.restaurantName = name.toLowerCase();
        markers.push(marker);

        // Add sidebar card
        var card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<strong>${name}</strong><br>${address}<br>${phone}<br>${website}${directionsLink}`;
        card.restaurantName = name.toLowerCase();
        card.addEventListener('click', function() {
          map.setView([lat, lon], 17);
          marker.openPopup();
        });
        cardList.appendChild(card);

        // Highlight card when marker clicked
        marker.on('click', function() {
          var allCards = document.querySelectorAll('.card');
          allCards.forEach(c=>c.style.background='white');
          card.style.background='#e0f7fa';
        });
      });
    })
    .catch(err => console.error(err));

  // Search input to filter markers and cards
  var searchInput = document.getElementById('searchInput');
  searchInput.addEventListener('input', function() {
    var query = this.value.toLowerCase();
    var firstMatch = null;
    markers.forEach((marker, index) => {
      var card = cardList.children[index];
      if(marker.restaurantName.includes(query)) {
        marker.addTo(map);
        card.style.display='block';
        if(!firstMatch) firstMatch = marker;
      } else {
        map.removeLayer(marker);
        card.style.display='none';
      }
    });
    if(firstMatch) {
      map.setView(firstMatch.getLatLng(),17);
      firstMatch.openPopup();
    }
  });
</script>

</body>
</html>
